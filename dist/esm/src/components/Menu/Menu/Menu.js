import{slicedToArray as e}from"../../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as n}from"react/jsx-runtime";import t from"classnames";import{SIZES as s}from"../../../constants/sizes.js";import o,{forwardRef as i,useRef as u,useState as r,useMemo as l,useCallback as d,useEffect as a,useLayoutEffect as c}from"react";import m from"../../../hooks/useMergeRefs.js";import p from"../../../hooks/useClickOutside/index.js";import{backwardCompatibilityForProperties as v}from"../../../helpers/backwardCompatibilityForProperties.js";import f from"./hooks/useSubMenuIndex.js";import M from"./hooks/useOnCloseMenu.js";import b from"./hooks/useCloseMenuOnKeyEvent.js";import I from"./hooks/useMenuKeyboardNavigation.js";import x from"./hooks/useMouseLeave.js";import{useAdjacentSelectableMenuIndex as h}from"./hooks/useAdjacentSelectableMenuIndex.js";import{useFocusWithin as S}from"../../../hooks/useFocusWithin.js";import j from"../../../hooks/usePrevious/index.js";import{withStaticProps as O}from"../../../types/withStaticProps.js";import{getStyle as k}from"../../../helpers/typesciptCssModulesHelper.js";import{getTestId as g}from"../../../tests/test-ids-utils.js";import{ComponentDefaultTestId as C}from"../../../tests/constants.js";import{useFocusOnMount as y}from"./hooks/useFocusOnMount.js";import{useMenuId as A}from"./hooks/useMenuId.js";import{generateMenuItemId as E}from"./utils/utils.js";import P from"./Menu.module.scss.js";var F=i((function(s,i){var O=s.id,N=s.className,B=s.classname,D=s.size,L=void 0===D?F.sizes.MEDIUM:D,V=s.tabIndex,z=void 0===V?0:V,T=s.ariaLabel,U=void 0===T?"Menu":T,W=s.ariaDescribedBy,w=s.children,H=s.isVisible,K=void 0===H||H,R=s.onClose,_=s.focusOnMount,q=void 0!==_&&_,G=s.focusItemIndex,J=void 0===G?-1:G,Q=s.focusItemIndexOnMount,X=void 0===Q?-1:Q,Y=s.isSubMenu,Z=void 0!==Y&&Y,$=s.useDocumentEventListeners,ee=void 0!==$&&$,ne=s.shouldScrollMenu,te=void 0!==ne&&ne,se=s["data-testid"],oe=A(O),ie=u(null),ue=m({refs:[ie,i]}),re=v([N,B]),le=r(J),de=e(le,2),ae=de[0],ce=de[1],me=r(!1),pe=e(me,2),ve=pe[0],fe=pe[1],Me=l((function(){return o.Children.toArray(w).filter((function(e){return!!e.type.isMenuChild||(console.error("Menu child must be a menuChild item (such as MenuItem, MenuDivider, MenuTitle, etc). This child is not supported: ",e),!1)}))}),[w]),be=d((function(e){var n,t,s;ce(e);var i=Me[e],u=o.isValidElement(i)?(null===(n=null==i?void 0:i.props)||void 0===n?void 0:n.id)||"".concat(oe,"-item-").concat(e):void 0;u?null===(t=null==ie?void 0:ie.current)||void 0===t||t.setAttribute("aria-activedescendant",u):null===(s=null==ie?void 0:ie.current)||void 0===s||s.removeAttribute("aria-activedescendant")}),[Me,oe]),Ie=d((function(e){be(e),fe(!1)}),[be]),xe=f(),he=xe.setSubMenuIsOpenByIndex,Se=xe.hasOpenSubMenu,je=xe.openSubMenuIndex,Oe=xe.resetOpenSubMenuIndex,ke=M({setActiveItemIndex:Ie,setOpenSubMenuIndex:xe.setOpenSubMenuIndex,onClose:R});p({ref:ie,callback:function(){return ke()}}),b({hasOpenSubMenu:Se,onCloseMenu:ke,ref:ie,onClose:R,isSubMenu:Z,useDocumentEventListeners:ee});var ge=h({children:Me}),Ce=ge.getNextSelectableIndex,ye=ge.getPreviousSelectableIndex;I({hasOpenSubMenu:Se,getNextSelectableIndex:Ce,getPreviousSelectableIndex:ye,activeItemIndex:ae,setActiveItemIndex:Ie,isVisible:K,ref:ie,useDocumentEventListeners:ee}),x({resetOpenSubMenuIndex:Oe,hasOpenSubMenu:Se,ref:ie,setActiveItemIndex:Ie}),y({focusItemIndexOnMount:X,focusChildOnMount:Me[X],getNextSelectableIndex:Ce,updateActiveItemIndex:be,setIsInitialFocusSet:fe});var Ae=d((function(){fe(!0)}),[fe]),Ee=j(Se);a((function(){var e;Se||ee||ae>-1&&Ee&&(null===(e=null==ie?void 0:ie.current)||void 0===e||e.focus())}),[ae,Se,Ee,ee]),c((function(){q&&!ee&&requestAnimationFrame((function(){ie&&ie.current&&ie.current.focus()}))}),[ie,q,ee]);var Pe=S({onBlurWithin:function(){ke&&ke()}}).focusWithinProps;return n("ul",Object.assign({onFocus:null==Pe?void 0:Pe.onFocus,onBlur:null==Pe?void 0:Pe.onBlur,id:oe,"data-testid":se||g(C.MENU,O),className:t(P.menu,k(P,L),re),ref:ue,tabIndex:z,"aria-label":U,role:"menu","aria-describedby":W,onMouseOver:Ae},{children:Me&&o.Children.map(Me,(function(e,n){return o.isValidElement(e)?o.cloneElement(e,Object.assign(Object.assign({},null==e?void 0:e.props),{activeItemIndex:ae,index:n,setActiveItemIndex:be,menuRef:ie,resetOpenSubMenuIndex:Oe,isParentMenuVisible:K,setSubMenuIsOpenByIndex:he,hasOpenSubMenu:n===je,closeMenu:ke,id:E(oe,e,n),useDocumentEventListeners:ee,isInitialSelectedState:ve,shouldScrollMenu:te,getNextSelectableIndex:Ce,getPreviousSelectableIndex:ye,isUnderSubMenu:Z})):null}))}))}));Object.assign(F,{isMenu:!0,supportFocusOnMount:!0});var N=O(F,{sizes:s});export{N as default};
