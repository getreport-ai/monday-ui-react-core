import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as i,jsxs as r}from"react/jsx-runtime";import n,{forwardRef as t,useRef as s,useState as a,useCallback as d,useMemo as l,useLayoutEffect as g}from"react";import c from"classnames";import p from"../Dialog/Dialog.js";import m from"../DialogContentContainer/DialogContentContainer.js";import u from"../Tooltip/Tooltip.js";import{backwardCompatibilityForProperties as f}from"../../helpers/backwardCompatibilityForProperties.js";import h from"../../hooks/useMergeRefs.js";import{BUTTON_ICON_SIZE as T}from"../Button/ButtonConstants.js";import{withStaticProps as C}from"../../types/withStaticProps.js";import{MenuButtonSize as E,MenuButtonComponentPosition as S}from"./MenuButtonConstants.js";import{HideShowEvent as v}from"../Dialog/consts/dialog-show-hide-event.js";import{NOOP as w}from"../../utils/function-utils.js";import{getStyle as j}from"../../helpers/typesciptCssModulesHelper.js";import{camelCase as M}from"lodash-es";import{getTestId as b,ComponentDefaultTestId as O}from"../../tests/test-ids-utils.js";import P from"./MenuButton.module.scss.js";import N from"../Icon/Icons/components/Menu.js";import{AnimationType as y}from"../../constants/dialog.js";var A=[u.hideShowTriggers.MOUSE_ENTER],D=[v.CLICK,v.ENTER],I=[],R={main:0,secondary:-6},_=t((function(t,C){var S,v=t.id,z=t.className,B=t.componentClassName,L=t.openDialogComponentClassName,H=t.children,x=t.component,K=void 0===x?N:x,U=t.componentPosition,k=void 0===U?_.componentPositions.START:U,F=t.size,W=void 0===F?E.SMALL:F,Y=t.open,X=void 0!==Y&&Y,V=t.onClick,q=void 0===V?w:V,G=t.zIndex,J=void 0===G?null:G,Q=t.ariaLabel,Z=void 0===Q?"Menu":Q,$=t.closeDialogOnContentClick,ee=void 0!==$&&$,oe=t.dialogOffset,ie=void 0===oe?R:oe,re=t.dialogPosition,ne=void 0===re?p.positions.BOTTOM_START:re,te=t.dialogClassName,se=t.dialogPaddingSize,ae=void 0===se?m.sizes.MEDIUM:se,de=t.dialogShowTriggerIgnoreClass,le=t.dialogHideTriggerIgnoreClass,ge=t.onMenuHide,ce=void 0===ge?w:ge,pe=t.onMenuShow,me=void 0===pe?w:pe,ue=t.disabled,fe=void 0!==ue&&ue,he=t.text,Te=t.tooltipContent,Ce=t.disabledReason,Ee=t.tooltipTriggers,Se=void 0===Ee?[_.hideTriggers.MOUSE_LEAVE]:Ee,ve=t.tooltipPosition,we=void 0===ve?_.dialogPositions.RIGHT:ve,je=t.startingEdge,Me=void 0===je?"bottom":je,be=t.removeTabCloseTrigger,Oe=void 0!==be&&be,Pe=t.tooltipReferenceClassName,Ne=t.hideWhenReferenceHidden,ye=void 0!==Ne&&Ne,Ae=t.dialogContainerSelector,De=t.active,Ie=t["data-testid"],Re=s(null),_e=h({refs:[C,Re]}),ze=a(X),Be=e(ze,2),Le=Be[0],He=Be[1],xe=null!=De?De:Le,Ke=d((function(e){if(e&&"Escape"===e.key){He(!1);var o=Re.current;window.requestAnimationFrame((function(){o.focus()}))}}),[Re,He]),Ue=d((function(e,o){He(!1),ce();var i=Re.current;window.requestAnimationFrame((function(){i&&o===p.hideShowTriggers.ESCAPE_KEY&&i.focus()}))}),[He,ce,Re]),ke=d((function(){He(!0),me()}),[He,me]),Fe=l((function(){var e=new Set([p.hideShowTriggers.CLICK_OUTSIDE,p.hideShowTriggers.TAB_KEY,p.hideShowTriggers.ESCAPE_KEY]);return ee&&(e.add(p.hideShowTriggers.CONTENT_CLICK),e.add(p.hideShowTriggers.ENTER)),Oe&&e.delete(p.hideShowTriggers.TAB_KEY),[n.Children.toArray(H).map((function(o){if(!n.isValidElement(o))return null;var i={};return o.type&&o.type.supportFocusOnMount&&(i.focusOnMount=!0,e.delete(p.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(i.onClose=Ke),n.cloneElement(o,i)})),Array.from(e)]}),[H,Ke,ee,Oe]),We=e(Fe,2),Ye=We[0],Xe=We[1],Ve=l((function(){return 0===Ye.length?null:i(m,Object.assign({size:ae,type:m.types.POPOVER},{children:Ye}))}),[Ye,ae]),qe=l((function(){return Object.assign(Object.assign({},R),ie)}),[ie]),Ge=K,Je=l((function(){switch(W){case E.XXS:case E.XS:return 16;case E.SMALL:case E.MEDIUM:case E.LARGE:return T;default:return 24}}),[W]),Qe=Ge?i(Ge,{size:""+Je,role:"img","aria-hidden":"true"}):null;g((function(){He(X)}),[X,He]);var Ze=f([Te,Ce]),$e=f([z,B]);return i(u,Object.assign({content:Ze,position:we,showTrigger:A,hideTrigger:Se,referenceWrapperClassName:Pe,hideWhenReferenceHidden:ye},{children:i(p,Object.assign({wrapperClassName:te,position:ne,containerSelector:Ae,startingEdge:Me,animationType:y.EXPAND,content:Ve,moveBy:qe,showTrigger:fe?I:D,hideTrigger:Xe,showTriggerIgnoreClass:de,hideTriggerIgnoreClass:le,useDerivedStateFromProps:!0,onDialogDidShow:ke,onDialogDidHide:Ue,referenceWrapperClassName:P.referenceIcon,zIndex:J,isOpen:Le,hideWhenReferenceHidden:ye},{children:r("button",Object.assign({id:v,"data-testid":Ie||b(O.MENU_BUTTON,v),ref:_e,type:"button",className:c(P.wrapper,$e,j(P,M("size-".concat(W))),(S={},o(S,P.open,xe),o(S,j(P,L),Le&&L),o(S,P.disabled,fe),o(S,P.text,he),S)),"aria-haspopup":"true","aria-expanded":Le,"aria-label":!he&&Z,onMouseUp:function(e){fe?e.currentTarget.blur():q(e)},"aria-disabled":fe},{children:[k===_.componentPositions.START&&Qe,he&&i("span",Object.assign({className:P.innerText},{children:he})),k===_.componentPositions.END&&Qe]}))}))}))})),z=C(_,{sizes:E,paddingSizes:m.sizes,dialogPositions:p.positions,hideTriggers:p.hideShowTriggers,componentPositions:S});export{z as default};
