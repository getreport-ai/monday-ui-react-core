import{slicedToArray as o,defineProperty as e}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsxs as i,jsx as t}from"react/jsx-runtime";import{camelCase as s,noop as r,isFunction as n}from"lodash-es";import a from"classnames";import{forwardRef as l,useRef as d,useState as c,useCallback as m,useMemo as p}from"react";import{getStyle as u}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as b,ComponentDefaultTestId as v}from"../../tests/test-ids-utils.js";import f from"../../hooks/useMergeRefs.js";import h from"../Search/Search.js";import g from"../Button/Button.js";import C from"../Text/Text.js";import x from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as O}from"./ComboboxService.js";import{ComboboxItems as j}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as y}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as I,useKeyboardNavigation as N}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as S}from"./helpers.js";import{withStaticProps as F}from"../../types/withStaticProps.js";import k from"./Combobox.module.scss.js";import{BASE_SIZES as H}from"../../constants/sizes.js";var T=l((function(l,x){var F,H=l.className,L=void 0===H?"":H,M=l.optionClassName,R=void 0===M?"":M,w=l.searchWrapperClassName,z=l.id,A=void 0===z?"":z,B=l.placeholder,V=void 0===B?"":B,W=l.size,D=void 0===W?T.sizes.MEDIUM:W,E=l.defaultVisualFocusFirstIndex,P=l.optionLineHeight,X=void 0===P?32:P,_=l.optionsListHeight,U=l.autoFocus,Y=void 0!==U&&U,q=l.disabled,G=void 0!==q&&q,J=l.options,K=void 0===J?[]:J,Q=l.categories,Z=l.withCategoriesDivider,$=void 0!==Z&&Z,oo=l.noResultsMessage,eo=void 0===oo?"No results found":oo,io=l.onAddNew,to=l.addNewLabel,so=void 0===to?"Add new":to,ro=l.onClick,no=void 0===ro?function(o){}:ro,ao=l.filter,lo=void 0===ao?O:ao,co=l.disableFilter,mo=void 0!==co&&co,po=l.onFilterChanged,uo=l.loading,bo=void 0!==uo&&uo,vo=l.onOptionHover,fo=void 0===vo?r:vo,ho=l.onOptionLeave,go=void 0===ho?r:ho,Co=l.shouldScrollToSelectedItem,xo=void 0===Co||Co,Oo=l.noResultsRenderer,jo=l.stickyCategories,yo=void 0!==jo&&jo,Io=l.optionRenderer,No=void 0===Io?null:Io,So=l.renderOnlyVisibleOptions,Fo=void 0!==So&&So,ko=l.clearFilterOnSelection,Ho=void 0!==ko&&ko,To=l.maxOptionsWithoutScroll,Lo=l.defaultFilter,Mo=void 0===Lo?"":Lo,Ro=l["data-testid"],wo=d(null),zo=d(null),Ao=c(Mo),Bo=o(Ao,2),Vo=Bo[0],Wo=Bo[1],Do=f({refs:[x,wo]}),Eo=m((function(o){po&&po(o),Wo(o)}),[Wo,po]),Po=m((function(o,e,i){fo(o,e,i)}),[fo]),Xo=p((function(){return mo?K:lo(Vo,K)}),[K,Vo,lo,mo]),_o=c(-1),Uo=o(_o,2),Yo=Uo[0],qo=Uo[1],Go=m((function(o){return void 0!==o&&Xo[o]&&!Xo[o].disabled}),[Xo]),Jo=m((function(){io&&io(Vo),Wo("")}),[io,Vo,Wo]),Ko=Xo.length>0,Qo=Vo.length>0;var Zo=c(),$o=o(Zo,2),oe=$o[0],ee=$o[1],ie=m((function(o){var e,i;(null===(e=null==o?void 0:o.category)||void 0===e?void 0:e.label)!==oe&&ee(null===(i=null==o?void 0:o.category)||void 0===i?void 0:i.label)}),[oe]),te=I({categories:Q,options:Xo,filterValue:Vo,withCategoriesDivider:$,optionLineHeight:X}),se=te.items,re=te.itemsMap,ne=te.selectableItems,ae=m((function(o,e){no(ne[e]),Go(e)&&qo(e),Ho&&Eo("")}),[no,ne,Go,Ho,Eo]),le=N({getOptionId:S,defaultVisualFocusFirstIndex:E,onClick:ae,isChildSelectable:Go,options:ne,inputRef:zo}),de=le.visualFocusItemIndex,ce=le.visualFocusItemId,me=le.onOptionClick;return i(C,Object.assign({type:C.types.TEXT2,ref:Do,className:a(k.combobox,L,u(k,s("size-"+D)),(F={},e(F,k.empty,!Ko),e(F,k.stickyCategory,yo),F)),id:A,"data-testid":Ro||b(v.COMBOBOX,A),ellipsis:!1},{children:[i("div",Object.assign({className:k.comboboxList,style:{maxHeight:_},role:"listbox"},{children:[t(h,{ref:zo,value:Vo,wrapperClassName:a(k.comboboxSearchWrapper,w),className:k.comboboxSearch,inputAriaLabel:"Search for content",activeDescendant:ce,id:"combobox-search",placeholder:V,size:D,disabled:G,onChange:Eo,autoFocus:Y,loading:bo}),yo&&t(y,{label:oe}),t(j,{categories:Q,options:se,itemsMap:re,optionClassName:R,optionRenderer:No,activeItemIndex:Yo,onActiveCategoryChanged:ie,onOptionClick:me,onOptionEnter:Po,onOptionLeave:go,optionLineHeight:X,shouldScrollToSelectedItem:xo,renderOnlyVisibleOptions:Fo,maxOptionsWithoutScroll:To,visualFocusItemIndex:de})]})),Qo&&!Ko&&!bo&&(Oo?Oo():i("div",Object.assign({className:k.comboboxNoResults},{children:[t("div",Object.assign({className:k.comboboxMessageWrapper},{children:t("span",Object.assign({className:k.comboboxMessage},{children:eo}))})),io&&!G&&t(g,Object.assign({className:k.addNewButton,size:D,kind:g.kinds.TERTIARY,onClick:Jo},{children:t("span",Object.assign({className:k.buttonLabel},{children:n(so)?so(Vo):so}))}))]})))]}))})),L=F(T,{sizes:H,iconTypes:x.iconTypes});export{L as default};
