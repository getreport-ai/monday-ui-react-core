import{slicedToArray as r}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{jsx as t}from"react/jsx-runtime";import{forwardRef as e,useState as o,useRef as n,useCallback as i,useMemo as l,useEffect as s}from"react";import u from"classnames";import{VariableSizeGrid as c}from"react-window";import a from"react-virtualized-auto-sizer";import{getNormalizedItems as d,getOnItemsRenderedData as f,isLayoutDirectionScrollbarVisible as m}from"../../services/virtualized-service.js";import v from"../../hooks/usePrevious/index.js";import h from"../../hooks/useThrottledCallback.js";import p from"../../hooks/useMergeRefs.js";import{NOOP as I}from"../../utils/function-utils.js";import{getTestId as g,ComponentDefaultTestId as j}from"../../tests/testIds.js";import w from"./VirtualizedGrid.module.scss.js";var x=e((function(e,x){var b=e.className,T=e.id,R=e.items,S=void 0===R?[]:R,C=e.itemRenderer,z=void 0===C?function(r,t,e){return r}:C,N=e.getRowHeight,M=void 0===N?function(){return 50}:N,O=e.getColumnWidth,k=void 0===O?function(){return 100}:O,V=e.getItemId,W=void 0===V?function(r,t){return r.id}:V,y=e.onScroll,A=e.scrollToId,D=void 0===A?null:A,G=e.onScrollToFinished,H=void 0===G?I:G,U=e.onItemsRendered,_=void 0===U?null:U,F=e.onItemsRenderedThrottleMs,P=void 0===F?200:F,q=e.onSizeUpdate,B=void 0===q?I:q,E=e.onVerticalScrollbarVisiblityChange,L=void 0===E?null:E,Z=e.scrollableClassName,J=e["data-testid"],K=o(0),Q=r(K,2),X=Q[0],Y=Q[1],$=o(0),rr=r($,2),tr=rr[0],er=rr[1],or=v(D),nr=n(null),ir=n(null),lr=n(null),sr=n(0),ur=n({scrollOffsetInitial:0,scrollOffsetFinal:0,animationStartTime:0}),cr=p({refs:[x,nr]}),ar=ur.current,dr=i((function(r){var t=M();return t&&!Number.isNaN(t)||console.error("Couldn't get height for item: ",r),t}),[M]),fr=i((function(r,t){var e=W(r,t);return void 0===e&&console.error("Couldn't get id for item: ",r),e}),[W]),mr=l((function(){return d(S,fr,dr)}),[S,fr,dr]),vr=l((function(){return Math.min(S.length,Math.floor(tr/k()))}),[S,tr,k]),hr=l((function(){return vr>0?Math.ceil(S.length/vr):0}),[S,vr]),pr=l((function(){return D%vr}),[D,vr]),Ir=l((function(){return Math.floor(D/vr)}),[D,vr]),gr=i((function(r){var t=r.horizontalScrollDirection,e=r.scrollTop,o=r.scrollUpdateWasRequested;sr.current=e,o||(ar.scrollOffsetInitial=e),y&&y(t,e,o)}),[y,sr,ar]),jr=i((function(r){var t=r.rowIndex*vr+r.columnIndex;return z(S[t],t,r.style)}),[S,z,vr]),wr=i((function(r,t){t===X&&r===tr||setTimeout((function(){Y(t),er(r),B(r,t)}),0)}),[X,tr,B]),xr=h((function(r){if(_){var t=f(S,mr,fr,r.visibleStartIndex,r.visibleStopIndex,X,sr.current);_(t)}}),{wait:P,trailing:!0},[_,S,mr,fr,X]);return s((function(){D&&or!==D&&(lr.current.scrollToItem({align:"center",columnIndex:pr,rowIndex:Ir}),H())}),[D,or,lr,pr,Ir,H]),s((function(){lr.current&&lr.current.resetAfterIndices({columnIndex:0,rowIndex:0})}),[mr]),s((function(){if(L){var r=m(S,mr,fr,X);ir.current!==r&&(ir.current=r,L(r))}}),[L,S,mr,X,fr]),t("div",Object.assign({ref:cr,className:u(w.virtualizedGridWrapper,b),id:T,"data-testid":J||g(j.VIRTUALIZED_GRID,T)},{children:t(a,{children:function(r){var e=r.height,o=r.width;return wr(o,e),t(c,Object.assign({ref:lr,height:e,width:o,columnWidth:k,columnCount:vr,rowHeight:M,rowCount:hr,onScroll:gr,onItemsRendered:xr,className:Z},{children:jr}))}})}))}));export{x as default};
